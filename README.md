# ts2pts

ARIB 規格の MPEG-2 TS を Partial TS（PTS）へ変換するソフトウェアです。

オリジナル版である up0796.zip に up0802.zip のパッチを適用し、さらに若干の見た目の修正と新機能を加えたものです。

オリジナル版にはライセンスに関する記載がなかったためそのソースコードをここに置くのはライセンス的にグレーですが、2020年現在も有用なソフトなのでサルベージの意味も込めて置くことにしました。

### PTS 化のメリット

いくつかあると思いますが、東芝 REGZA で再生したときに詳細な番組情報を表示できるようになるのが私にとって最も重宝するポイントです。


## オリジナル版からの変更点
オリジナルのソースコードからの変更点は以下のとおりです。

- up0802.zip（getoptize.patch）を適用した
- ヘルプを追加した
- メッセージを微修正した
- 一部のコンパイル時警告を回避した
- up0802.zip により Windows でビルドできなくなっていた問題を修正した
- 新たに `--meta` オプションを追加した

オリジナル版の README は [ts2pts.txt](ts2pts.txt) です。

### mod版との関係

ts2pts には mod 版が存在します（mod1～mod8まである模様）が、mod 版のソースコードが入手できなかったため本リポジトリには mod 版によるバグ修正や機能追加はまったく含まれていません。ご了承ください。\
（mod 版のソースコードの場所をご存知の方、お持ちの方はぜひご連絡いただけるとと嬉しいです！）


## ビルド環境

オリジナル版は Windows のみを対象としたものですが、up0802.zip パッチにより Linux でビルドが可能になり、さらに本リポジトリでの改修により Windows / Linux 両対応となっています。

- Windows では Visual Studio でソリューションファイル（`ts2pts.sln`）を開いてください。
- Linux では make してください。


## `--meta` オプションについて

新たに `--meta` オプションを追加しました。コマンドライン引数に `--meta hoge.ts` と記述することで、PTS 化に必要な SIT を `hoge.ts` をもとに生成します（デフォルトでは入力 TS ファイルから SIT を生成する）。

### ユースケース
2021年11月現在、TS ファイルを ffmpeg や NVEnc などを用いてエンコードすると、エンコード済み TS には SIT を生成するための情報が欠落します。そのため既存の ts2pts ではエンコード済み TS ファイルを PTS 化することができません。（できる方法があればぜひ教えてください！）

そこで最新版では、ts2pts 実行時に入力 TS としてエンコード済み TS ファイル、メタデータ用 TS としてオリジナルの TS ファイルを指定することで、オリジナルの TS ファイルの情報をもとに SIT を生成し、エンコード済み TS ファイルを PTS 化させることができます。
```
ts2pts --in encoded.ts --meta original.ts --out output.ts
```

### 注意

--meta オプションの機能はかなり強引に実装しています。また、コードの差分を最小限にするため非効率でもあります。\
ろくに検証もしていないので、使用の際はその旨を十分に理解の上でご利用ください。
